<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
<meta charset="UTF-8" />
<meta name="keywords" content=" " />
<meta name="description" content=" " />
<title>搜尋結果</title>
</head>

<script>
    var main;
    window.onload =function() {
        let cid = location.href.split("=")[1][0];
        let courseName = decodeURI(location.href).split("n=")[1];
        fetch("control.php?act=getInfo&cid=" + cid)
        .then(function(resp){
            console.log(resp);
            return resp.json();
        })
        .then(function(json) {
            if (json) {
                let colArr = [];
                let num = 1;
                for (let i=1; i < json.length; i++) {
                    if (json[i]['aid'] != json[i-1]['aid']) {
                        colArr.push(num);
                        num = 1;
                    } else {
                        num += 1;
                        if (i == json.length-1) {
                            colArr.push(num)
                        }
                    }
                }
                let tableStr = "<table border=1><tr><th>";
                tableStr += "title</th><th>";
                tableStr += "content</th><th>";
                tableStr += "floor</th><th>";
                tableStr += "comment</th></tr>";
                var index = 0;
                for (let i=0; i < colArr.length; i++) {
                    tableStr += "<tr><td rowspan=" + colArr[i] + ">" + json[index]['title'];
                    tableStr += "</td><td rowspan=" + colArr[i] + ">" + json[index]['content'];
                    tableStr += "</td><td>" + json[index]['floor'];
                    tableStr += "</td><td>" + json[index]['content'] + "</td></tr>";
                    index += 1;
                    temp = index;
                    for (let j=temp; j < temp+colArr[i]-1; j++) {
                        tableStr += "<tr><td>" + json[j]['floor'];
                        tableStr += "</td><td>" + json[j]['comment'] + "</td></tr>";
                        index += 1;
                    }
                }
                tableStr += "</table>";
                document.getElementById("main").innerHTML = tableStr;
            }
        })
    }
</script>

<body>
<div id="main"></div>
</body>
</html>
